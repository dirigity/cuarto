<html>
    <head>
        <style>
            canvas {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            body{
                width: 100%;
                height: 100%;
                margin: 0px;
                padding: 0px;
            }
        </style>
    </head>
    <body>  
        <canvas id="canvas" width="1920" height="1080"></canvas>
        <script>
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");
            var y = 300;
            var vy =0;
            var ay = 1;;
            var keys = {};
            var tall = 30;
            var indiceDeRebotamiento = 2;
            var particulas = [];
            window.onkeyup = function(e) { keys[e.keyCode] = false; }
            window.onkeydown = function(e) { keys[e.keyCode] = true; }
            
            function drawXYrect(x, y, grosor, color) {
                //console.log("fufo?")
                if(color) 
                  ctx.fillStyle = color; 
                else 
                  ctx.fillStyle = "#555555";
                ctx.fillRect(x, y, grosor, grosor);
            }
            tick();
            function tick(){
                ctx.fillRect(0, 0, canvas.height, canvas.width);
                canvas.height = canvas.clientHeight;
                canvas.width = canvas.clientWidth;
                vy = vy + ay;
                if(y+vy<=canvas.height-30){
                    if(y+vy>=0){
                        y = y + vy;
                    }else{
                        y=0;
                        vy = -vy/indiceDeRebotamiento;
                    }
                    
                }else{
                    y=canvas.height-tall;
                    vy = -vy/indiceDeRebotamiento;
                }
                //console.log(keys[32],ay);
                if(keys[32]==true){
                    ay =-0.05
                    for (let i = 0; i < 2; i++) {
                        var angulo = -((Math.random()*Math.PI/2)+Math.PI*1.25);
                        var vx2 = Math.cos(angulo)*10;
                        var vy2 = Math.sin(angulo)*10;
                        particulas.push([0,100+tall/2,y+tall,vx2,vy2]);
                    }

                    
                }else{
                    ay = 0.1
                }

                for (let i = 0; i < particulas.length; i++) {
                    const element = particulas[i];
                    element[0]=element[0]+5;
                    element[1]=element[1]+element[3];
                    element[2]=element[2]+element[4];
                    console.log(ay,vy,element[1],element[2]);
                    drawXYrect(element[1],element[2],10,rgb(255,element[0],0));
                    if(element[0]>100){
                        particulas.splice(i,1);
                        i--;
                    }
                }
                
                //console.log("posy:"+y+" vely:"+vy);
                
                drawXYrect(100,y,tall);


                setTimeout(() => {
                    tick();
                }, 1);
            }

            function rgb(r,g,b) {
                var r_ = check(decToHex(r));
                var g_ = check(decToHex(g));
                var b_ = check(decToHex(b));
                return "#"+r_+g_+b_;
            }

            function decToHex(n) {
                if(n<0){
                    n = 0xFFFFFFFF + n + 1;
                }
                return Math.round(n).toString(16).toUpperCase();
            }

            function check(n){
                //console.log(n)
                if(n.length>2){
                    return "FF";
                }else if (n.length<2){
                    return "0"+n;

                }else return n
            }
        </script>
    </body>
</html>


